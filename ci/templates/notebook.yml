
parameters:
  azureResourceManagerConnection: none
  KeyVaultName: none
  SubscriptionId: none
  ResourceGroup: none
  DbxWorkspaceName: none
  DbxWorkspaceUrl: none
  DbxWorkspaceSubDirs: none
  DbxWorkspaceRoot: none

# strategy:
#   matrix:
#     Python38:
#       python.version: '3.8'

steps:

  - task: UsePythonVersion@0
    inputs:
      versionSpec: '3.8'
    displayName: 'Use Python 3.8'

  - task: AzureKeyVault@1
    inputs:
      azureSubscription: ${{ parameters.azureResourceManagerConnection }}
      KeyVaultName: ${{ parameters.KeyVaultName }}
      SecretsFilter: '*'
      RunAsPreJob: false

  - task: CmdLine@2
    displayName: "install wheel"
    inputs:
        script: |
                python -m pip install autobricks==0.1.4.dev1

  - task: PythonScript@0
    displayName: "upload notebooks to DBX"
    inputs:
      scriptSource: 'filePath'
      scriptPath: ci/python/upload_notebooks_to_dbx.py
    # env:
    #   AUTH_TYPE: "SERVICE_PRINCIPAL_MGMT_ENDPOINT"
    #   TENANT_ID: $(SVCDirectoryID)
    #   SP_CLIENT_ID: $(SVCDirectoryID)
    #   SP_CLIENT_SECRET: $(SVCSecretKey)
    #   WORKSPACE_NAME: ${{ parameters.DbxWorkspaceName }}
    #   RESOURCE_GROUP: ${{ parameters.ResourceGroup }}
    #   SUBSCRIPTION_ID: ${{ parameters.SubscriptionId }}
    #   DATABRICKS_API_HOST: ${{ parameters.DbxWorkspaceUrl }}
      # QDPCLIHOME: "$(System.DefaultWorkingDirectory)/ci/"
      # ROOT_DIR: $(System.DefaultWorkingDirectory)
      # WORKSPACE_SUBDIRS: ${{ parameters.DbxWorkspaceSubDirs }}
      # WORKSPACE_ROOT: ${{ parameters.DbxWorkspaceRoot }}